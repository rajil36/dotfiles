LPSiteNotification=function(){var t=!1,e=!1,n=!1,r=!1,i=500,a=function(t){for(var e=0;e<t.fields.length;++e)if("password"===t.fields[e].type)return!0;return!1},o=(u=!1,function(e){u||(u=!0,setTimeout(function(){u=!1},i),a(e)?(e.generatedPassword||(t=!0),bg.LPTabState.processPasswordSubmit({formData:e,callback:e.generatedPassword||LPContentScriptTools.isUnloading()?null:E})):e.fields.length>0&&(bg.LPTabState.processTextSubmit(e),bg.LPTabState.clear()))}),u,s=(c='input:not([type]),input[type="text"],input[type="email"],input[type="password"]',l=function(t){return t.value&&(t.value!==t.getAttribute("value")||t.value.length>1)&&LPContentScriptTools.isVisible(t)},f=function(t){for(var e,n=[],r=(t||document.body).querySelectorAll(c),i=0;i<r.length;++i)l(r[i])&&n.push(r[i]);return n},d=function(t){for(var e=[],n={},r={},i=t.length<1e3?t.length:1e3,a=0;a<i;++a){var o=t[a];switch(o.type){case"hidden":case"text":case"email":!o.value||"hidden"!==o.type&&LPContentScriptTools.isVisible(o)||(n.hasOwnProperty(o.value)?delete r[o.value]:(r[o.value]=o,n[o.value]=!0))}}var u,s={};return LPContentScriptTools.findTextNodes({searches:Object.keys(r),searchAll:!0,exactMatch:!0,allowEmails:!0}).filter(function(t){return!s.hasOwnProperty(t.match)&&(s[t.match]=!0,!0)}).forEach(function(t){t.parent&&"OPTION"!==t.parent.nodeName&&LPContentScriptTools.isVisible(t.parent)&&e.push(r[t.match])}),e},p=function(t){var e={type:t.type,value:t.value,id:t.id,label:LPContentScriptTools.getLabel(t),attributes:LPContentScriptTools.getAttributes(t,["name","ng-model","data-reactid"])};return"password"!==e.type&&"disc"===LPContentScriptTools.getCSS(t,"text-security")&&(e.type="password"),e},v=function(t,e){for(var n=[],r=0;r<t.length;++r){var i=t[r];"password"!==i.inputData.type&&(i.inputData.value=H.getUnmaskedValue({input:i.input,inputValue:i.inputData.value,form:e.form})),i.inputData.formname=e.form&&e.form.getAttribute("name")||"",n.push(i.inputData)}return{url:document.location.href,top:window===top,fields:n,generatedPassword:e.generatedPassword,username:H.getUsername()}},function(t){if(bg.get("LPContentScriptFeatures").save_a_site_fearlessly_dedupe&&W(t.generateFormAction))return null;var e=f(t.form);t.form&&(e=d(t.form).concat(e));for(var n=[],r=0;r<e.length;++r){var i=e[r],a=p(i);n.push({input:i,inputData:a})}var u=v(n,t);return t.deferred||o(u),u}),c,l,f,d,p,v,g=(m=null,b=function(){m=null},function(t){return function(e){if(m=!1!==e.isTrusted&&!1!==m)try{t(e)}catch(t){Raven.captureException(t)}setTimeout(b,0)}}),m,b,h=(T=function(t,n,r){var i=S(t);return!(!i||!LPContentScriptTools.isVisible(i))&&(r&&!LPContentScriptTools.isClickable(i)?(e=!0,!1):!n.passwordChangeForm||i.value===t.value)},S=function(t){if(t.id)return document.getElementById(t.id);for(var e in t.attributes){var n=document.querySelector("input["+e+'="'+t.attributes[e]+'"]');if(n)return n}return null},L=function(t,e){for(var n=0;n<t.fields.length;++n){var r=t.fields[n];if("password"===r.type)return T(r,t,e)}return!1},P=function(t,e){var n=S(t);n&&n.addEventListener("input",g(function(){e(!0)}))},w=function(t,e){for(var n=0;n<t.fields.length;++n){var r=t.fields[n];"password"===r.type&&P(r,e)}},function(e,n){var r=0,i=20,a=null,o=!1,u=function(e){o||(t=!1,o=!0,clearInterval(a),n(e))};t?(a=setInterval(function(){var t=20==++r,n=L(e,t);n&&!t||u(n)},1e3),w(e,u)):u(L(e))}),T,S,L,w,P,y=function(t){if(!n){n=!0,t.postSetup=function(){Topics.get(Topics.SITE_NOTIFICATION).publish(r)};var e={css:{top:10,right:10}},r=LPFrame.openDialog("contentScriptSite",t,e);C(t,e),r.onClose(function(){n=!1})}},C=function(t,e){var r=0,i,a=6,o=setInterval(function(){r++,document.getElementsByTagName("iframe").length<1&&n&&r<=6&&(dialog=LPFrame.openDialog("contentScriptSite",t,e),clearInterval(o)),r>6&&clearInterval(o)},3e3)},E=function(t){LPContentScriptTools.isUnloading()||(Topics.get(Topics.SITE_NOTIFICATION_STATE).publish(t),bg.get("LPContentScriptFeatures").new_save_site&&t.dialogData&&!e&&csTop.LPSiteNotification.showSiteNotification(t))},N=(I=function(t){return(t=t.toLowerCase()).indexOf("submit")>-1||t.indexOf("save")>-1},_=function(t){for(var e=t.attributes,n=0;n<e.length;++n){var r=e[n];if(I(r.name)||I(r.value))return!0}return!1},function(t){if("INPUT"===t.nodeName)return"submit"===t.type||"button"===t.type&&_(t);for(var e=t;e&&0===e.getElementsByTagName("input").length;){if("BUTTON"===e.nodeName)return"submit"===e.type||_(e);if(_(e))return!0;e=e.parentElement}return!1}),I,_,D=function(t){switch(t.nodeName){case"TEXTAREA":case"SELECT":return!0;case"INPUT":switch(t.type){case"button":case"submit":return!1;default:return!0}default:return!1}},O=(x=null,A=[],k=function(t){for(var e=0;e<t.length;++e){var n=t[e];switch(n.type){case"attributes":if(n.target.getAttribute(n.attributeName)!==n.oldValue)return!0;break;default:return!0}}return!1},V=function(t){k(t)&&(A.forEach(function(t){t()}),F())},{reset:F=function(){x&&(x.disconnect(),x=null),A=[]},onChange:function(t){"undefined"!=typeof MutationObserver&&(x||(x=new MutationObserver(V)).observe(document.body,{childList:!0,attributes:!0,characterData:!0,subtree:!0,attributeOldValue:!0}),-1===A.indexOf(t)&&A.push(t),setTimeout(function(){F()},0))}}),x,A,F,k,V,U,q=(R=[],{startTracking:function(t,e){var n=function(r){if(t(r.detail)){window.removeEventListener("lprequeststart",n);var i=function(t){r.detail.requestID===t.detail.requestID&&(window.removeEventListener("lprequestend",i),e(t.detail))};window.addEventListener("lprequestend",i)}};window.addEventListener("lprequeststart",n),R.push(n)},stopTracking:function(){R.forEach(function(t){window.removeEventListener("lprequeststart",t)}),R=[]}}),R,B,M,H=function(){var e=null,n=!1,i=[];Topics.get(Topics.FILLED_GENERATED_PW).subscribe(function(t){bg.get("LPContentScriptFeatures").save_a_site_fearlessly_dedupe&&(r=!0),a({target:t.element,generatedPassword:t.password,generateFormAction:!0})}),Topics.get(Topics.CLEAR_DATA).subscribe(function(t){L()}),Topics.get(Topics.LOGIN).subscribe(function(t){bg.LPTabState.getState(function(t){t.enabled&&S(t)})});var a=function(t){return t.form=LPContentScriptTools.getForm(t.target),s(t)},u=function(){t=!1,bg.LPTabState.clear()},c=function(t){try{return decodeURIComponent(t)}catch(t){}return null},l=function(t){var e=t&&t.formData;e&&e.fields.length>0&&(q.stopTracking(),q.startTracking(function(t){if(t&&t.data)for(var n=c(t.data),r=0;r<e.fields.length;++r){var i=e.fields[r].value;if(n&&n.indexOf(i)>-1||t.data.indexOf(i)>-1)return!0}return!1},t.responseHandler))},f=(d=/^2[0-9][0-9]$/,function(t){return d.test(t)}),d,p=function(t){return 0===t},v=function(t){l({formData:t,responseHandler:function(t){f(t.statusCode)||p(t.statusCode)||u()}})},m=function(t){var e=a({target:t,deferred:!0});l({formData:e,responseHandler:function(t){f(t.statusCode)&&o(e)}})},b={submit:g(function(t){O.reset(),v(s({form:LPContentScriptTools.getForm(t.target),type:t.type}))}),lpsubmit:function(t){O.reset(),s({form:t.target,type:"submit"})},mouseup:g(function(e){var n=e.target;N(n)?(O.reset(),v(a({target:n,type:e.type}))):D(n)||(t&&O.onChange(u),m(n))}),keydown:g(function(e){if(13===(e.keyCode||e.which)){var n=e.target;D(n)||N(n)?(O.reset(),v(a({target:n,type:e.type}))):(t&&O.onChange(u),m(n))}}),change:g(function(t){var e=t.target;if("INPUT"===e.nodeName&&e.value)switch(e.type){case"text":case"email":for(var n=0;n<i.length;++n)if(i[n].input===e)return void(i[n].value=e.value);i.push({input:e,value:e.value})}}),paste:g(function(t){var e=t.target;D(t.target)&&bg.LPTabState.getCopiedGeneratedPassword(function(t){e.value===t&&a({target:e,generatedPassword:t})})})},h=function(t){e=t},T=function(){if(e.usernames&&e.usernames.length>0)return LPContentScriptTools.findText({searches:e.usernames,wordMatch:!0})},S=function(t){if(should_do_lastpass_here(document)&&(h(t),!n)){for(var e in b)document.addEventListener(e,b[e],!0);n=!0}},L=function(){if(n){for(var t in b)document.removeEventListener(t,b[t],!0);n=!1}i=[]},w=function(t){return t.indexOf("*")>-1||t.indexOf(String.fromCharCode(8226))>-1},P=function(t,e){return t.value&&!w(t.value)&&t.value.length===e.length&&(t.value[0]===e[0]||t.value[t.value.length-1]===e[e.length-1])},y=function(t){if(w(t.inputValue)){var e;for(e=0;e<i.length;++e){var n=i[e];if(n.input===t.input&&n.value!==t.inputValue)return n.value}if(t.form)for(e=0;e<t.form.length;++e){var r=t.form[e];if(P(r,t.inputValue))return r.value}}return t.inputValue};return function(){var t=document.documentElement;if(t&&"HTML"===t.nodeName)if(g_ischrome||g_issafari_appext){var e=document.createElement("script");e.appendChild(document.createTextNode(LPContentScriptConstants.JS.PageWebRequestEvents)),t.appendChild(e),t.removeChild(e)}else Topics.get(Topics.INITIALIZED).subscribe(function(){var e=bg.get("extensionBaseURL");if(e){var n=document.createElement("script");n.src=e+"pageWebRequestEvents.js",t.appendChild(n),t.removeChild(n)}})}(),{setup:S,teardown:L,getUnmaskedValue:y,getUsername:T}}(),G=LPContentScriptTools.debounce(function(){bg.LPTabState.getSiteNotification({callback:E})},1e3,!0);Topics.get(Topics.INITIALIZED).subscribe(function(){bg.LPTabState.getState(function(t){t.enabled&&(H.setup(t),window===top?G():t.formSubmittedFrame&&csTop.LPSiteNotification.getSiteNotification())})}),window!==top&&window.addEventListener("beforeunload",function(){t&&csTop.LPSiteNotification.getSiteNotification()},!0);var W=function(t){var e=!1;return t||r&&(r=!1,e=!0),e};return{formExists:h,showSiteNotification:y,getSiteNotification:G}}();
//# sourceMappingURL=sourcemaps/addSiteNotification.js.map
